<template>
	<div></div>
</template>

<script>
import Axios from "axios";

export default {
	data() {
		return {
			a: [['411446.526','3392647.566'],
['414426.379','3390501.926'],
['410164.856','3394641.569'],
['409535.975','3393570.532'],
['409974.785','3394869.54'],
['410105.067','3393795.792'],
['412091.9','3396621.4'],
['405610.619','3400255.288'],
['408612.198','3395838.821'],
['411798.935','3393105.215'],
['412057.713','3392979.19'],
['411639.145','3392733.74'],
['412517.126','3391108.872'],
['410058.629','3391779.118'],
['410204.542','3392116.878'],
['412218.626','3393920.515'],
['410890.215','3393803.19'],
['411443.854','3392722.979'],
['411229.747','3395938.603'],
['389827.051','3370580.755'],
['453527.007','3367671.157'],
['367715.3','3431997.9'],
['413422.699','3358736.061'],
['417702.806','3359889.648'],
['405412.259','3355015.09'],
['413176.451','3385281.06'],
['411711.981','3393842.176'],
['413439.01','3390665.868'],
['410730.784','3391772.77'],
['415342.264','3397008.145'],
['414984.267','3397313.965'],
['416354.743','3396318.226'],
['440033.748','3382000.603'],
['435763.921','3391581.489'],
['434601.024','3415340.665'],
['434530.653','3415330.1'],
['409724.164','3425733.347'],
['409217.054','3425090.313'],
['426462','3407506.2'],
['401241.927','3417058.629'],
['384738.42','3374052.756'],
['453697.539','3367099.749'],
['461979.788','3351342.102'],
['485332.644','3362353.069'],
['485395.967','3362416.814'],
['451806.096','3358549.251'],
['483560.262','3375867.836'],
['451886.168','3385269.91'],
['447834.301','3384710.029'],
['470106.431','3351354.659'],
['398019.271','3445294.28'],
['443563.471','3373394.181'],
['411711.4','3394429.6'],
['400571.209','3397616.891'],
['400571.209','3397616.89'],
['411131.174','3394484.23'],
['409074.4','3394818.9'],
['412153.531','3394867.647'],
['411190.233','3397138.029'],
['409468','3402247'],
['408971.829','3392207.442'],
['434662.822','3415212.061'],
['391439.832','3381673.615'],
['401873.606','3380887.923'],
['400904.587','3355825.299'],
['401979.78','3354159.371'],
['402767.269','3353452.364'],
['338397.42','3358383.889'],
['366605.225','3385280.987'],
['364736.983','3407316.978'],
['377903.154','3400465.678'],
['365372.2','3404688.4'],
['478692.616','3388729.303'],
['442485.779','3422894.47'],
['349920.656','3338109.514'],
['411928.277','3392010.762'],
['413943.682','3391873.328'],
['412383.922','3391870.54'],
['411404.199','3394233.59'],
['407544.961','3393788.575'],
['411403.405','3394644.653'],
['417397.767','3396898.618'],
['422779.564','3420644.036'],
['435012.175','3415156.108'],
['434500.047','3415389.31'],
['434624.408','3415512.98'],
['434598.025','3415272.936'],
['434862.477','3415359.011'],
['434975.9','3415036.7'],
['434982.559','3415282.922'],
['434734.893','3415132.487'],
['434645.242','3415425.777'],
['434637.963','3415291.376'],
['435050.607','3415134.289'],
['409561.671','3425806.12'],
['403251.626','3414789.643'],
['388844.83','3398013.944'],
['389307.743','3398009.967'],
['391573.686','3385544.539'],
['402489.919','3365816.52'],
['389114.374','3414327.868'],
['392504.675','3410813.739'],
['367298.94','3377709.142'],
['367326.087','3377674.11'],
['367292.742','3377455.023'],
['429342.716','3363024.741'],
['409225.889','3395147.187'],
['411372.334','3396953.391'],
['435709.459','3391436.789'],
['420408.088','3411954.739'],
['386893.905','3385080.294'],
['395846.058','3384002.443'],
['455193.387','3369748.582'],
['367632.837','3431810.292'],
['406554.373','3434489.773'],
['341021.096','3367002.785'],
['357962.406','3403654.67'],
['472301.222','3405893.334'],
['447280.249','3411918.028'],
['350826.966','3390047.563'],
['348142.745','3391009.088'],
['348514.819','3338458.903']],
			count: 1,
		};
	},
	methods: {
		transformCgcs(x, y, s_srs) {
			return new Promise((resolve, reject) => {
				const method = `handleJsonpSuccess${this.count}`;
				this.count++;
				window[method] = resolve;
				const url = `https://epsg.io/trans?x=${x}&y=${y}&s_srs=${s_srs}&t_srs=4326&callback=${method}`;
				const script = document.createElement("script");
				script.src = url;
				document.body.append(script);
				script.addEventListener("load", () => {
					window[method] = undefined;
					document.body.removeChild(script);
				});
			});
		},
		sleep(n) {
			var start = new Date().getTime(); //定义起始时间的毫秒数
			while (true) {
				var time = new Date().getTime(); //每次执行循环取得一次当前时间的毫秒数
				if (time - start > n) {
					//如果当前时间的毫秒数减去起始时间的毫秒数大于给定的毫秒数，即结束循环
					break;
				}
			}
		},
	},
	mounted() {
		const that = this;
		let b = [];
		this.a.map((item, index) => {
			(function (a) {
				setTimeout(function () {
					if (item[2]) {
						// 102坐标转
						that.transformCgcs(item[0], item[1], 4543).then((res) => {
							b.push([res.x, res.y]);
							if (index == that.a.length - 1) {
								console.log(JSON.stringify(b), index, that.a.length);
							}
						});
					} else {
						// 105坐标系转
						that.transformCgcs(item[0], item[1], 4544).then((res) => {
							b.push([res.x, res.y]);
							if (index == that.a.length - 1) {
								console.log(JSON.stringify(b), index, that.a.length);
							}
						});
					}
				}, 5000 * a);
			})(index);
		});
	},
};
</script>

<style lang="scss" scoped></style>
